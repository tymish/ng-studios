<div class="container">
  <h1>Overview</h1>
  <mat-form-field appearance="outline">
    <mat-label>Year</mat-label>
    <mat-select
      [(ngModel)]="selectedYear"
      (selectionChange)="updateData(selectedYear)"
    >
      <mat-option [value]="2020">2020</mat-option>
      <mat-option [value]="2019">2019</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-accordion>
    <ng-template ngFor let-month [ngForOf]="monthAggregates$ | async">
      <mat-card *ngIf="!month.sentInvoices">
        <mat-card-header>
          <mat-card-title>
            <h2>{{ month.payPeriod | date: 'MMMM' }}</h2>
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <button
            mat-button
            color="primary"
            (click)="sendInvoices(month.payPeriod)"
          >
            REQUEST INVOICES
          </button>
        </mat-card-content>
      </mat-card>
      <mat-expansion-panel #panel class="mt-1" *ngIf="month.sentInvoices">
        <mat-expansion-panel-header collapsedHeight="100px">
          <mat-panel-title>
            <h2>
              <span>
                {{ month.payPeriod | date: 'MMMM' }}
              </span>
              <div class="title-spacer"></div>
              <mat-chip-list *ngIf="!panel.expanded">
                <mat-chip>{{ month.sentInvoices }} Sent</mat-chip>
                <mat-chip>{{ month.receivedInvoices }} Received</mat-chip>
                <mat-chip>{{ month.paidInvoices }} Paid</mat-chip>
              </mat-chip-list>
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="flex vertical space-between progress-group">
          <div class="flex space-between">
            Received invoices<span
              >{{ month.sentInvoices - month.receivedInvoices }} remaining</span
            >
          </div>
          <mat-progress-bar
            mode="determinate"
            [value]="percentDone(month.receivedInvoices, month.sentInvoices)"
          >
          </mat-progress-bar>
          <div>
            <button mat-button color="primary" class="shift-left">
              SEND REMINDER
            </button>
          </div>
        </div>
        <div class="spacer"></div>
        <div class="flex vertical space-between progress-group">
          <div class="flex space-between">
            Paid invoices<span>
              {{ month.sentInvoices - month.paidInvoices }} remaining
            </span>
          </div>
          <mat-progress-bar
            mode="determinate"
            [value]="percentDone(month.paidInvoices, month.sentInvoices)"
          >
          </mat-progress-bar>
          <div>
            <button
              mat-raised-button
              color="primary"
              [routerLink]="summaryRoutes(month)"
              class="w-100"
            >
              VIEW DETAILS
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </ng-template>
  </mat-accordion>
</div>
